function onDeviceReady(){if(connectedUser&&sessionUserData.modeApp){day=(new Date).getDate(),month=(new Date).getMonth(),year=(new Date).getFullYear(),today=(new Date).getDay(),0==today&&(today=7);for(var i=1;8>i;i++)readingDay="sessionUserData.day"+i,dayConfig=eval(readingDay),1==dayConfig&&(next_time=getNextWeekDay(new Date(year,month,day,sessionUserData.time_displayed,0,0),i),cordova.plugins.notification.local.schedule({id:i,title:notification_bible_reading_title,text:notification_bible_reading_text,at:next_time,data:{reading:!0}})),1==sessionUserData.dailyComment&&(t=i+7,next_time=getNextWeekDay(new Date(year,month,day,sessionUserData.time_displayed,0,0),i),cordova.plugins.notification.local.schedule({id:t,title:notification_daily_comment_title,text:notification_daily_comment_text,at:next_time}));cordova.plugins.notification.local.on("click",function(e){'{"reading":true}'==e.data&&(window.location.hash="#todayReading")});var displayRateApp=!1;"undefined"===sessionUserData.rateAppAcceptance?displayRateApp=!0:"0"===sessionUserData.rateAppAcceptance?displayRateApp=calculateDiffDays(sessionUserData.registrationDay):"2"===sessionUserData.rateAppAcceptance&&(displayRateApp=calculateDiffDays(sessionUserData.rateAppAcceptance)),displayRateApp&&displayView("rateApp",null)}}function getNextWeekDay(e,t){if(t>e.getDay())var n=t-e.getDay();else var n=7+t-e.getDay();return e.setDate(e.getDate()+n),e}function calculateDiffDays(e){var t=9,n=new Date(year,month,day),a=e.split("-"),i=new Date(a[0],a[1],a[2]),l=Math.round((n-i)/864e5);return l>t?!0:!1}function loadFile(file,type){$.ajax({url:"http://jwreading.com/ajax/getMinifiedContent.php",data:{file:file,type:type},async:!1,complete:function(data){var elements="";$.each(data,function(e,t){"responseText"==e&&(el=t.split("\\r\\n"),$.each(el,function(e,t){elements+="css"===type?t:t+";"}))});var eval_file=eval(elements),appendString,page_location="body";"lang"===type?appendString='<script class="lang">'+eval_file+"</script>":"js"===type?appendString="<script>"+eval_file+"</script>":"css"===type&&(appendString="<style>"+eval_file+"</style>",page_location="head"),"undefined"!=typeof MSApp&&MSApp?MSApp.execUnsafeLocalFunction(function(){$(page_location).append(appendString)}):$(page_location).append(appendString)}})}document.addEventListener("deviceready",onDeviceReady,!1),function(){function init(){function loadTemplate(element,tmpl,tmplMenu,activeMenu){var displaySubscribe=!1;if("subscribe"==element){displaySubscribe=!0,element="account";var attach=new accountView}displaySubscribe&&(tmpl=tmpl.replace(new RegExp("{{account_","g"),"{{subscribe_"));var context=buildContext(tmpl),view="new "+element+"View()",result=eval(view),html=compileTemplate(tmpl,context,result);if(activeMenu){var contextMenu=buildContext(tmplMenu);contextMenu[activeMenu]="active";var resultMenu=new menuView,menuHtml=compileTemplate(tmplMenu,contextMenu,resultMenu);$("#menuContent").html(menuHtml)}else $("#menuContent").html("");"firstTime"===element||"rateApp"===element?$("#tmplContent").html(html):slider.slidePage($("<div>").html(html)),loggedOut&&($("#logoutValidate").show(),loggedOut=!1)}function buildContext(tmpl){var context={},i=0;if("undefined"!=typeof sessionUserData&&sessionUserData)var userData=sessionUserData;var tab=tmpl.split("{{");return $.each(tab,function(key,value){if(i>0){var cond=value.substr(0,4);if("#"!=value[0]&&"/"!=value[0]&&">"!=value[0]&&"{"!=value[0]&&"!"!=value[0]&&"else"!=cond){var tab2=value.split("}}"),expr=tab2[0];context[expr]=eval(expr)}}i++}),context}function compileTemplate(e,t,n){n&&$.each(n,function(e,n){t[e]=n});var a=Handlebars.compile(e),i=a(t);return i=escapeLink(i)}function escapeLink(e){return e=e.replace(new RegExp("&lt;","g"),"<"),e=e.replace(new RegExp("&gt;","g"),">"),e=e.replace(new RegExp("&quot;","g"),'"'),e=e.replace(new RegExp("&#x27;","g"),"'"),e=e.replace(new RegExp("{{{","g"),""),e=e.replace(new RegExp("}}}","g"),"")}function checkNeedLogin(e){var t=["dashboard","todayReading","account"];return referrer=e,t.indexOf(e)>-1&&!window.connectedUser&&(e="login"),e}function isElementInViewport(e){e=e[0];var t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}loadFile("assets/lang/common.js","lang"),loadFile("lib/jwreading.js","js"),loadFile("assets/css/jwreading.css","css"),window.displayView=function(e,t){$.ajax({url:"http://jwreading.com/ajax/getMinifiedContent.php",method:"get",data:{view:e,menu:t},dataType:"json",async:!1,success:function(n){var a=n.minifiedJs,i=n.minifiedTmpl,l=n.minifiedMenuJs,o=n.minifiedMenuTmpl;$(".view").remove();var s='<script class="view">'+a+"</script>";"undefined"!=typeof MSApp&&MSApp?MSApp.execUnsafeLocalFunction(function(){$("body").append(s)}):$("body").append(s);var s='<script class="view">'+l+"</script>";"undefined"!=typeof MSApp&&MSApp?MSApp.execUnsafeLocalFunction(function(){$("body").append(s)}):$("body").append(s),loadTemplate(e,i,o,t)},error:function(){$("#tmplContent").html("Internet connection problem")}})},window.analyzeHash=function(){if(hash=window.location.hash.substr(1),!hash){if(!localStorage.firstTimeOver)return displayView("firstTime",null),!1;hash="dashboard"}hash=checkNeedLogin(hash);var e=hash+"_active";displayView(hash,e)},analyzeHash(),$(window).on("hashchange",function(){analyzeHash()}),setInterval(function(){$("#resize").length&&(isElementInViewport($(".title"))?$("#resize").fadeIn():$("#resize").fadeOut()),window.innerWidth<768?isElementInViewport($(".title"))?$(".navbar-toggle").fadeIn():$(".navbar-toggle").fadeOut():$(".navbar-toggle").show()},1e3),window.validateEmail=function(e){var t=/^([\w-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([\w-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/;return t.test(e)?!0:!1}}window.lang,window.langList,window.hash,window.connectedUser=!1,window.sessionUserData,window.loggedOut=!1,window.referrer="",slider=new PageSlider($("#tmplContent")),localStorage.getItem("lang")?lang=localStorage.getItem("lang"):(lang=window.navigator.userLanguage||window.navigator.language,lang=lang.substr(0,2),lang=$.trim(lang),localStorage.setItem("lang",lang)),localStorage.getItem("sessionUserData")&&(sessionUserData=JSON.parse(localStorage.getItem("sessionUserData")),connectedUser=!0),$.ajax({url:"http://jwreading.com/ajax/getMinifiedContent.php",data:{file:"assets/lang/langs.txt"},async:!1,complete:function(e){$.each(e,function(e,t){if("responseText"==e){t=JSON.parse(t),langList=t.split("\n");var n=!1;$.each(langList,function(e,t){t=$.trim(t),lang==t&&(n=!0)}),n||(lang="en")}})}}),window.displayLang=function(){$(".lang").remove(),loadFile("assets/lang/"+lang+".js","lang")},displayLang(),window.languages=[{lang:"fr",name:lang_fr},{lang:"en",name:lang_en},{lang:"it",name:lang_it},{lang:"es",name:lang_es},{lang:"de",name:lang_de},{lang:"ro",name:lang_ro}],init()}();